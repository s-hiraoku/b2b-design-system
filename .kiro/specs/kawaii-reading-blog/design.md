# æŠ€è¡“è¨­è¨ˆæ›¸

## æ¦‚è¦

ã‹ã‚ã„ã„èª­æ›¸ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã¯ã€èª­æ›¸æ„›å¥½å®¶å‘ã‘ã®ã‚¤ãƒ©ã‚¹ãƒˆèª¿ã®ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ç‰¹å¾´ã¨ã™ã‚‹ãƒ–ãƒ­ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚Next.js 15ã¨React 19ã‚’åŸºç›¤ã¨ã—ã€Framer Motionã€Lottieã€Anime.jsãªã©ã®é«˜åº¦ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ´»ç”¨ã—ã¦ã€60FPSã®æ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨é­…åŠ›çš„ãªã‹ã‚ã„ã„ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚èª­æ›¸è¨˜éŒ²ã€é€²æ—è¿½è·¡ã€ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½ã‚’çµ±åˆã—ã€æ¥½ã—ãé­…åŠ›çš„ãªèª­æ›¸ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

## è¦ä»¶å¯¾å¿œãƒãƒƒãƒ”ãƒ³ã‚°

### è¨­è¨ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¯¾å¿œé–¢ä¿‚

å„è¨­è¨ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç‰¹å®šã®è¦ä»¶ã«å¯¾å¿œï¼š

- **ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ** â†’ REQ-1: ã‹ã‚ã„ã„ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³
- **èª­æ›¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ** â†’ REQ-2: èª­æ›¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³** â†’ REQ-3: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- **èª­æ›¸é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°** â†’ REQ-4: èª­æ›¸è¨˜éŒ²è¿½è·¡
- **æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ** â†’ REQ-5: æ¤œç´¢ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼æ©Ÿèƒ½
- **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½** â†’ REQ-6: ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯** â†’ REQ-7: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- **ãƒ¡ãƒ‡ã‚£ã‚¢ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ** â†’ REQ-8: ç”»åƒãƒ»ã‚¤ãƒ©ã‚¹ãƒˆç®¡ç†
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–** â†’ REQ-9: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- **SEOãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£** â†’ REQ-10: SEOãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å¯¾å¿œ

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼1**: ã‹ã‚ã„ã„ãƒ‘ã‚¹ãƒ†ãƒ«ã‚«ãƒ©ãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ â†’ ã‚«ãƒ¯ã‚¤ã‚¤ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ†ãƒ¼ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼2**: æœ¬ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„èª­æ›¸è¨˜äº‹ã®æŠ•ç¨¿ãƒ»ç®¡ç† â†’ ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼3**: æ»‘ã‚‰ã‹ã§æ¥½ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ â†’ Framer Motion + CSS3ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼4**: èª­æ›¸é€²æ—ã‚„çµ±è¨ˆã®è¦–è¦šçš„è¿½è·¡ â†’ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–èª­æ›¸ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼5**: èˆˆå‘³ã®ã‚ã‚‹æœ¬ã‚„è¨˜äº‹ã®æ¤œç´¢ â†’ Algoliaæ¤œç´¢ã¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
graph TB
    subgraph "Frontend Layer"
        A[Next.js 15 App Router]
        B[React 19 Components]
        C[Kawaii Design System]
        D[Animation Engine]
    end
    
    subgraph "Content Management"
        E[Sanity CMS]
        F[MDX Blog Content]
        G[Book Metadata API]
    end
    
    subgraph "Data Layer"
        H[PostgreSQL Database]
        I[Redis Cache]
        J[File Storage]
    end
    
    subgraph "External Services"
        K[Cloudinary Images]
        L[Algolia Search]
        M[NextAuth.js]
        N[Vercel Analytics]
    end
    
    A --> B
    B --> C
    B --> D
    A --> E
    A --> F
    A --> G
    A --> H
    A --> I
    A --> J
    A --> K
    A --> L
    A --> M
    A --> N
```

### æŠ€è¡“çš„æ„æ€æ±ºå®šã®æ ¹æ‹ 

**Next.js 15 App Routeré¸æŠç†ç”±:**
- Server Components ã«ã‚ˆã‚‹é«˜é€ŸåˆæœŸè¡¨ç¤ºï¼ˆ3ç§’ä»¥å†…ã®ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ï¼‰
- èª­æ›¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åŠ¹ç‡çš„ãªStatic Site Generation
- ç”»åƒæœ€é©åŒ–ã«ã‚ˆã‚‹ã‹ã‚ã„ã„ã‚¤ãƒ©ã‚¹ãƒˆã®é«˜å“è³ªè¡¨ç¤º
- SEOæœ€é©åŒ–ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¤œç´¢æ€§å‘ä¸Š

**ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ„ã¿åˆã‚ã›:**
- Framer Motion: è¤‡é›‘ãªãƒšãƒ¼ã‚¸é·ç§»ã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- Lottie: ã‹ã‚ã„ã„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- CSS3 Animations: è»½é‡ãªãƒã‚¤ã‚¯ãƒ­ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
- Anime.js: èª­æ›¸é€²æ—ã®æ•°å€¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æŠ€è¡“

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 15 (App Router, Server Components)
- **UI ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: React 19 with TypeScript 5.x
- **çŠ¶æ…‹ç®¡ç†**: Zustand + React Query (TanStack Query)
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS 4 with Kawaii custom theme
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: Framer Motion + Lottie + Anime.js + CSS3
- **UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: Radix UI + shadcn/ui + Custom Kawaii Components
- **ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†**: React Hook Form + Zod validation
- **ç”»åƒå‡¦ç†**: Next.js Image + Sharp + Cloudinary

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æŠ€è¡“

- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL (Supabase) - èª­æ›¸è¨˜éŒ²ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis - æ¤œç´¢çµæœã¨ãƒšãƒ¼ã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **CMS**: Sanity Studio - ãƒ–ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†
- **èªè¨¼**: NextAuth.js - ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Cloudinary - ç”»åƒãƒ»ã‚¤ãƒ©ã‚¹ãƒˆæœ€é©åŒ–
- **æ¤œç´¢**: Algolia - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ã¨é«˜åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **åˆ†æ**: Vercel Analytics - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

### é–‹ç™ºãƒ»é‹ç”¨æŠ€è¡“

- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: pnpm
- **ãƒ†ã‚¹ãƒˆ**: Vitest + React Testing Library + Playwright
- **ã‚³ãƒ¼ãƒ‰å“è³ª**: ESLint + Prettier + TypeScript strict mode
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Vercel - è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- **ç›£è¦–**: Sentry - ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### èª­æ›¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart LR
    A[ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›] --> B[React Hook Form]
    B --> C[Zod ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³]
    C --> D[API Route]
    D --> E[PostgreSQL]
    E --> F[Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥]
    F --> G[ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤º]
    
    H[Sanity CMS] --> I[MDXå‡¦ç†]
    I --> J[é™çš„ç”Ÿæˆ]
    J --> K[CDNé…ä¿¡]
    
    L[Cloudinary] --> M[ç”»åƒæœ€é©åŒ–]
    M --> N[WebP/AVIFå¤‰æ›]
    N --> O[ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–é…ä¿¡]
```

### èª­æ›¸é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant C as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    participant A as API
    participant D as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    participant R as Redis
    
    U->>C: èª­æ›¸é€²æ—æ›´æ–°
    C->>A: POST /api/reading-progress
    A->>D: é€²æ—ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    A->>R: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
    A->>C: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    C->>U: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãæ›´æ–°è¡¨ç¤º
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆéšå±¤

```mermaid
graph TB
    A[App Layout] --> B[Header]
    A --> C[Main Content]
    A --> D[Footer]
    
    B --> E[Navigation]
    B --> F[Search Box]
    B --> G[User Menu]
    
    C --> H[Blog Posts]
    C --> I[Reading Dashboard]
    C --> J[Book Gallery]
    
    H --> K[Post Card]
    H --> L[Category Filter]
    
    I --> M[Progress Chart]
    I --> N[Reading Stats]
    I --> O[Book List]
    
    J --> P[Book Card]
    J --> Q[Lightbox Viewer]
```

### ã‚«ãƒ¯ã‚¤ã‚¤ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

#### ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³

```typescript
// lib/design-tokens.ts
export const KawaiiTokens = {
  colors: {
    primary: {
      50: '#fef7f7',   // æœ€ã‚‚è–„ã„ãƒ”ãƒ³ã‚¯
      100: '#feeaea',   // è–„ã„ãƒ”ãƒ³ã‚¯
      200: '#fdd5d5',   // ã‚½ãƒ•ãƒˆãƒ”ãƒ³ã‚¯
      300: '#fab5b5',   // ãƒ©ã‚¤ãƒˆãƒ”ãƒ³ã‚¯
      400: '#f59595',   // ãƒŸãƒ‡ã‚£ã‚¢ãƒ ãƒ”ãƒ³ã‚¯
      500: '#ef4444',   // ãƒ¡ã‚¤ãƒ³ãƒ”ãƒ³ã‚¯
      600: '#dc2626',   // æ·±ã„ãƒ”ãƒ³ã‚¯
      700: '#b91c1c',   // ãƒ€ãƒ¼ã‚¯ãƒ”ãƒ³ã‚¯
      800: '#991b1b',   // æ¿ƒã„ãƒ”ãƒ³ã‚¯
      900: '#7f1d1d',   // æœ€ã‚‚æ¿ƒã„ãƒ”ãƒ³ã‚¯
    },
    secondary: {
      50: '#f0f9ff',   // è–„ã„ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼
      100: '#e0f2fe',   // ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼
      200: '#bae6fd',   // ã‚½ãƒ•ãƒˆãƒ–ãƒ«ãƒ¼
      300: '#7dd3fc',   // ãƒŸãƒ‡ã‚£ã‚¢ãƒ ãƒ–ãƒ«ãƒ¼
      400: '#38bdf8',   // ãƒ–ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼
      500: '#0ea5e9',   // ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ«ãƒ¼
      600: '#0284c7',   // æ·±ã„ãƒ–ãƒ«ãƒ¼
      700: '#0369a1',   // ãƒ€ãƒ¼ã‚¯ãƒ–ãƒ«ãƒ¼
      800: '#075985',   // æ¿ƒã„ãƒ–ãƒ«ãƒ¼
      900: '#0c4a6e',   // æœ€ã‚‚æ¿ƒã„ãƒ–ãƒ«ãƒ¼
    },
    accent: {
      yellow: '#fef3c7',  // å„ªã—ã„é»„è‰²
      lavender: '#f3e8ff', // ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼
      mint: '#d1fae5',    // ãƒŸãƒ³ãƒˆ
      peach: '#fed7aa',   // ãƒ”ãƒ¼ãƒ
    },
    neutral: {
      50: '#fafafa',    // ã»ã¼ç™½
      100: '#f5f5f5',   // è–„ã„ã‚°ãƒ¬ãƒ¼
      200: '#e5e5e5',   // ãƒ©ã‚¤ãƒˆã‚°ãƒ¬ãƒ¼
      300: '#d4d4d4',   // ãƒŸãƒ‡ã‚£ã‚¢ãƒ ã‚°ãƒ¬ãƒ¼
      400: '#a3a3a3',   // ã‚°ãƒ¬ãƒ¼
      500: '#737373',   // ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼
      600: '#525252',   // æ¿ƒã„ã‚°ãƒ¬ãƒ¼
      700: '#404040',   // æ·±ã„ã‚°ãƒ¬ãƒ¼
      800: '#262626',   // ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼
      900: '#171717',   // æœ€ã‚‚æ¿ƒã„ã‚°ãƒ¬ãƒ¼
    }
  },
  
  spacing: {
    xs: '0.5rem',    // 8px
    sm: '0.75rem',   // 12px  
    md: '1rem',      // 16px
    lg: '1.5rem',    // 24px
    xl: '2rem',      // 32px
    '2xl': '3rem',   // 48px
    '3xl': '4rem',   // 64px
  },
  
  borderRadius: {
    sm: '0.375rem',  // 6px - ãƒœã‚¿ãƒ³
    md: '0.5rem',    // 8px - ã‚«ãƒ¼ãƒ‰
    lg: '0.75rem',   // 12px - ãƒ¢ãƒ¼ãƒ€ãƒ«
    xl: '1rem',      // 16px - å¤§ããªã‚«ãƒ¼ãƒ‰
    full: '9999px',  // å®Œå…¨ãªå††å½¢
  },
  
  shadows: {
    soft: '0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.06)',
    medium: '0 4px 16px rgba(0, 0, 0, 0.08), 0 2px 6px rgba(0, 0, 0, 0.12)',
    strong: '0 8px 32px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.18)',
  },
  
  animations: {
    duration: {
      fast: '150ms',
      normal: '250ms',
      slow: '350ms',
      slower: '500ms',
    },
    easing: {
      bounce: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',
      soft: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
      sharp: 'cubic-bezier(0.55, 0.085, 0.68, 0.53)',
    }
  }
};
```

#### ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

```typescript
// components/kawaii/KawaiiButton.tsx
interface KawaiiButtonProps {
  variant?: 'primary' | 'secondary' | 'accent';
  size?: 'sm' | 'md' | 'lg';
  children: React.ReactNode;
  onClick?: () => void;
  disabled?: boolean;
  loading?: boolean;
  icon?: React.ReactNode;
  className?: string;
}

export const KawaiiButton: React.FC<KawaiiButtonProps> = ({
  variant = 'primary',
  size = 'md',
  children,
  onClick,
  disabled = false,
  loading = false,
  icon,
  className = ''
}) => {
  const [isHovered, setIsHovered] = useState(false);
  const [isPressed, setIsPressed] = useState(false);

  const variants = {
    primary: 'bg-gradient-to-r from-pink-400 to-pink-500 text-white hover:from-pink-500 hover:to-pink-600',
    secondary: 'bg-gradient-to-r from-blue-400 to-blue-500 text-white hover:from-blue-500 hover:to-blue-600',
    accent: 'bg-gradient-to-r from-purple-400 to-pink-400 text-white hover:from-purple-500 hover:to-pink-500',
  };

  const sizes = {
    sm: 'px-3 py-2 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-6 py-3 text-lg',
  };

  return (
    <motion.button
      className={cn(
        'rounded-full font-medium transition-all duration-200',
        'shadow-soft hover:shadow-medium active:shadow-soft',
        'disabled:opacity-50 disabled:cursor-not-allowed',
        'flex items-center gap-2 justify-center',
        variants[variant],
        sizes[size],
        className
      )}
      onClick={onClick}
      disabled={disabled || loading}
      onHoverStart={() => setIsHovered(true)}
      onHoverEnd={() => setIsHovered(false)}
      onTapStart={() => setIsPressed(true)}
      onTapEnd={() => setIsPressed(false)}
      whileHover={{ 
        scale: disabled ? 1 : 1.05,
        y: disabled ? 0 : -2
      }}
      whileTap={{ 
        scale: disabled ? 1 : 0.95,
        y: disabled ? 0 : 0
      }}
      animate={{
        boxShadow: isHovered && !disabled 
          ? '0 8px 32px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.18)'
          : '0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.06)'
      }}
    >
      {loading && (
        <motion.div
          className="w-4 h-4 border-2 border-current border-t-transparent rounded-full"
          animate={{ rotate: 360 }}
          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
        />
      )}
      {icon && !loading && (
        <motion.div
          animate={{ rotate: isPressed ? 12 : 0 }}
          transition={{ duration: 0.1 }}
        >
          {icon}
        </motion.div>
      )}
      <span>{children}</span>
    </motion.button>
  );
};
```

```typescript
// components/kawaii/KawaiiCard.tsx
interface KawaiiCardProps {
  children: React.ReactNode;
  title?: string;
  description?: string;
  image?: string;
  imageAlt?: string;
  onClick?: () => void;
  hoverable?: boolean;
  className?: string;
}

export const KawaiiCard: React.FC<KawaiiCardProps> = ({
  children,
  title,
  description,
  image,
  imageAlt,
  onClick,
  hoverable = true,
  className = ''
}) => {
  const [isHovered, setIsHovered] = useState(false);

  return (
    <motion.div
      className={cn(
        'bg-white rounded-xl shadow-soft border border-neutral-100',
        'overflow-hidden transition-all duration-300',
        hoverable && 'hover:shadow-medium cursor-pointer',
        onClick && 'cursor-pointer',
        className
      )}
      onClick={onClick}
      onHoverStart={() => setIsHovered(true)}
      onHoverEnd={() => setIsHovered(false)}
      whileHover={hoverable ? { 
        y: -4,
        scale: 1.02,
      } : {}}
      whileTap={onClick ? { 
        scale: 0.98,
        y: -2
      } : {}}
      animate={{
        boxShadow: isHovered && hoverable
          ? '0 8px 32px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.18)'
          : '0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.06)'
      }}
    >
      {image && (
        <div className="relative aspect-video overflow-hidden">
          <Image
            src={image}
            alt={imageAlt || title || ''}
            fill
            className="object-cover transition-transform duration-300"
            style={{
              transform: isHovered ? 'scale(1.05)' : 'scale(1.0)'
            }}
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black/10 to-transparent" />
        </div>
      )}
      
      <div className="p-6">
        {title && (
          <h3 className="text-xl font-semibold text-neutral-800 mb-2">
            {title}
          </h3>
        )}
        
        {description && (
          <p className="text-neutral-600 mb-4 leading-relaxed">
            {description}
          </p>
        )}
        
        {children}
      </div>
    </motion.div>
  );
};
```

### èª­æ›¸é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// components/reading/ReadingProgressChart.tsx
interface ReadingProgressChartProps {
  books: ReadingBook[];
  timeframe: 'week' | 'month' | 'year';
  showAnimation?: boolean;
}

export const ReadingProgressChart: React.FC<ReadingProgressChartProps> = ({
  books,
  timeframe,
  showAnimation = true
}) => {
  const [animationComplete, setAnimationComplete] = useState(false);
  const chartData = useMemo(() => generateChartData(books, timeframe), [books, timeframe]);

  return (
    <KawaiiCard title="èª­æ›¸é€²æ—" className="col-span-2">
      <div className="space-y-4">
        {/* é€²æ—çµ±è¨ˆ */}
        <div className="grid grid-cols-3 gap-4">
          <motion.div
            className="text-center p-4 bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg"
            initial={{ scale: 0, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            transition={{ delay: 0.1, type: "spring", bounce: 0.5 }}
          >
            <div className="text-2xl font-bold text-pink-600">
              <AnimatedNumber value={chartData.totalBooks} />
            </div>
            <div className="text-sm text-pink-500">èª­ã‚“ã æœ¬</div>
          </motion.div>
          
          <motion.div
            className="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg"
            initial={{ scale: 0, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            transition={{ delay: 0.2, type: "spring", bounce: 0.5 }}
          >
            <div className="text-2xl font-bold text-blue-600">
              <AnimatedNumber value={chartData.totalPages} />
            </div>
            <div className="text-sm text-blue-500">ç·ãƒšãƒ¼ã‚¸æ•°</div>
          </motion.div>
          
          <motion.div
            className="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg"
            initial={{ scale: 0, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            transition={{ delay: 0.3, type: "spring", bounce: 0.5 }}
          >
            <div className="text-2xl font-bold text-purple-600">
              <AnimatedNumber value={chartData.averageRating} precision={1} />
            </div>
            <div className="text-sm text-purple-500">å¹³å‡è©•ä¾¡</div>
          </motion.div>
        </div>

        {/* é€²æ—ãƒãƒ£ãƒ¼ãƒˆ */}
        <div className="h-64 relative">
          <ResponsiveContainer width="100%" height="100%">
            <LineChart data={chartData.timeline}>
              <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
              <XAxis 
                dataKey="date" 
                tick={{ fontSize: 12, fill: '#666' }}
                axisLine={{ stroke: '#e0e0e0' }}
              />
              <YAxis 
                tick={{ fontSize: 12, fill: '#666' }}
                axisLine={{ stroke: '#e0e0e0' }}
              />
              <Tooltip 
                contentStyle={{
                  backgroundColor: 'white',
                  border: 'none',
                  borderRadius: '12px',
                  boxShadow: '0 4px 16px rgba(0, 0, 0, 0.1)'
                }}
              />
              <motion.line
                x1="0"
                y1="0"
                x2="100%"
                y2="0"
                stroke="url(#gradient)"
                strokeWidth="3"
                strokeLinecap="round"
                initial={{ pathLength: 0 }}
                animate={{ pathLength: showAnimation ? 1 : 1 }}
                transition={{ duration: 2, ease: "easeInOut" }}
              />
              <Line 
                type="monotone" 
                dataKey="books" 
                stroke="#f59e0b"
                strokeWidth={3}
                dot={{ fill: '#f59e0b', strokeWidth: 2, r: 4 }}
                activeDot={{ r: 6, fill: '#f59e0b' }}
              />
              <defs>
                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stopColor="#f59e0b" />
                  <stop offset="100%" stopColor="#f97316" />
                </linearGradient>
              </defs>
            </LineChart>
          </ResponsiveContainer>
        </div>

        {/* ç¾åœ¨èª­ã‚“ã§ã„ã‚‹æœ¬ */}
        <div className="border-t pt-4">
          <h4 className="font-semibold text-neutral-800 mb-3">ç¾åœ¨èª­ã‚“ã§ã„ã‚‹æœ¬</h4>
          <div className="space-y-3">
            {chartData.currentlyReading.map((book, index) => (
              <motion.div
                key={book.id}
                className="flex items-center gap-3 p-3 bg-neutral-50 rounded-lg"
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.1 }}
              >
                <div className="w-12 h-16 bg-gradient-to-br from-neutral-200 to-neutral-300 rounded"></div>
                <div className="flex-1">
                  <h5 className="font-medium text-neutral-800">{book.title}</h5>
                  <p className="text-sm text-neutral-600">{book.author}</p>
                  <div className="mt-2">
                    <div className="flex justify-between text-xs text-neutral-500 mb-1">
                      <span>{book.currentPage} / {book.totalPages} ãƒšãƒ¼ã‚¸</span>
                      <span>{Math.round((book.currentPage / book.totalPages) * 100)}%</span>
                    </div>
                    <motion.div 
                      className="h-2 bg-neutral-200 rounded-full overflow-hidden"
                      initial={{ width: 0 }}
                      animate={{ width: '100%' }}
                      transition={{ delay: 0.5 + index * 0.1 }}
                    >
                      <motion.div
                        className="h-full bg-gradient-to-r from-pink-400 to-pink-500 rounded-full"
                        initial={{ width: 0 }}
                        animate={{ width: `${(book.currentPage / book.totalPages) * 100}%` }}
                        transition={{ delay: 0.7 + index * 0.1, duration: 1, ease: "easeOut" }}
                      />
                    </motion.div>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      </div>
    </KawaiiCard>
  );
};
```

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³

```typescript
// lib/animations/kawaii-animations.ts
export const KawaiiAnimations = {
  // ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  pageTransition: {
    initial: { opacity: 0, y: 20 },
    animate: { opacity: 1, y: 0 },
    exit: { opacity: 0, y: -20 },
    transition: { duration: 0.3, ease: "easeInOut" }
  },

  // ãµã‚ãµã‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  float: {
    animate: {
      y: [-2, 2, -2],
      transition: {
        duration: 3,
        repeat: Infinity,
        ease: "easeInOut"
      }
    }
  },

  // ãƒã‚¦ãƒ³ã‚¹åŠ¹æœ
  bounce: {
    whileHover: { scale: 1.05, y: -2 },
    whileTap: { scale: 0.95, y: 0 },
    transition: { type: "spring", stiffness: 400, damping: 17 }
  },

  // ãƒãƒ¼ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
  heartParticle: {
    initial: { scale: 0, opacity: 0, y: 0 },
    animate: { 
      scale: [0, 1.2, 1],
      opacity: [0, 1, 0],
      y: [0, -50, -100],
      x: [0, Math.random() * 40 - 20, Math.random() * 80 - 40]
    },
    transition: { duration: 2, ease: "easeOut" }
  },

  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æœ¬ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  bookLoading: {
    animate: {
      rotateY: [0, 0, 180, 180, 0],
      transition: {
        duration: 2,
        repeat: Infinity,
        ease: "easeInOut",
        times: [0, 0.2, 0.5, 0.8, 1]
      }
    }
  },

  // ã‚¹ã‚¿ãƒƒã‚¬ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  stagger: {
    container: {
      animate: {
        transition: {
          staggerChildren: 0.1,
          delayChildren: 0.1
        }
      }
    },
    item: {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5, ease: "easeOut" }
    }
  },

  // èª­æ›¸é€²æ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  readingProgress: {
    initial: { width: 0 },
    animate: { width: "var(--progress-width)" },
    transition: { duration: 1.5, ease: "easeOut" }
  }
};

// ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ•ãƒƒã‚¯
export const useParticleAnimation = () => {
  const [particles, setParticles] = useState<Particle[]>([]);

  const createParticle = useCallback((x: number, y: number, type: 'heart' | 'star' | 'sparkle') => {
    const newParticle: Particle = {
      id: Math.random().toString(36).substr(2, 9),
      x,
      y,
      type,
      createdAt: Date.now()
    };
    
    setParticles(prev => [...prev, newParticle]);
    
    // 2ç§’å¾Œã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’å‰Šé™¤
    setTimeout(() => {
      setParticles(prev => prev.filter(p => p.id !== newParticle.id));
    }, 2000);
  }, []);

  return { particles, createParticle };
};
```

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(50) UNIQUE NOT NULL,
  display_name VARCHAR(100) NOT NULL,
  avatar_url TEXT,
  bio TEXT,
  reading_goal_books_per_month INTEGER DEFAULT 4,
  reading_goal_pages_per_day INTEGER DEFAULT 20,
  preferred_genres JSONB DEFAULT '[]',
  reading_level VARCHAR(20) DEFAULT 'intermediate',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æ›¸ç±ãƒã‚¹ã‚¿ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE books (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  isbn VARCHAR(20) UNIQUE,
  title VARCHAR(500) NOT NULL,
  subtitle VARCHAR(500),
  authors JSONB NOT NULL, -- ["author1", "author2"]
  publisher VARCHAR(200),
  published_date DATE,
  page_count INTEGER,
  genre JSONB DEFAULT '[]', -- ["fiction", "mystery"]
  language VARCHAR(10) DEFAULT 'ja',
  cover_image_url TEXT,
  cover_image_colors JSONB DEFAULT '[]', -- æŠ½å‡ºã•ã‚ŒãŸè‰²ãƒ‘ãƒ¬ãƒƒãƒˆ
  description TEXT,
  average_rating DECIMAL(3,2),
  rating_count INTEGER DEFAULT 0,
  goodreads_id VARCHAR(50),
  amazon_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- èª­æ›¸è¨˜éŒ²ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE reading_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  book_id UUID NOT NULL REFERENCES books(id) ON DELETE CASCADE,
  status VARCHAR(20) NOT NULL DEFAULT 'want_to_read', -- want_to_read, reading, finished, abandoned
  current_page INTEGER DEFAULT 0,
  total_pages INTEGER,
  user_rating INTEGER CHECK (user_rating >= 1 AND user_rating <= 5),
  review TEXT,
  reading_started_at TIMESTAMP WITH TIME ZONE,
  reading_finished_at TIMESTAMP WITH TIME ZONE,
  last_read_at TIMESTAMP WITH TIME ZONE,
  reading_sessions JSONB DEFAULT '[]', -- èª­æ›¸ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ²
  notes JSONB DEFAULT '[]', -- ãƒšãƒ¼ã‚¸ã”ã¨ã®ãƒ¡ãƒ¢
  bookmarks JSONB DEFAULT '[]', -- ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸãƒšãƒ¼ã‚¸
  favorite_quotes JSONB DEFAULT '[]', -- ãŠæ°—ã«å…¥ã‚Šã®å¼•ç”¨
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, book_id)
);

-- ãƒ–ãƒ­ã‚°è¨˜äº‹ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE blog_posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  author_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  title VARCHAR(200) NOT NULL,
  slug VARCHAR(200) UNIQUE NOT NULL,
  content TEXT NOT NULL, -- MDX content
  excerpt TEXT,
  featured_image_url TEXT,
  featured_image_alt TEXT,
  status VARCHAR(20) DEFAULT 'draft', -- draft, published, archived
  published_at TIMESTAMP WITH TIME ZONE,
  reading_time_minutes INTEGER,
  view_count INTEGER DEFAULT 0,
  like_count INTEGER DEFAULT 0,
  comment_count INTEGER DEFAULT 0,
  tags JSONB DEFAULT '[]',
  categories JSONB DEFAULT '[]',
  related_books JSONB DEFAULT '[]', -- é–¢é€£æ›¸ç±ã®IDé…åˆ—
  seo_title VARCHAR(60),
  seo_description VARCHAR(160),
  ogp_image_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ã‚³ãƒ¡ãƒ³ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE comments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID NOT NULL REFERENCES blog_posts(id) ON DELETE CASCADE,
  author_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  parent_id UUID REFERENCES comments(id) ON DELETE CASCADE, -- è¿”ä¿¡ã®å ´åˆ
  content TEXT NOT NULL,
  is_approved BOOLEAN DEFAULT TRUE,
  like_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ã„ã„ã­ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  target_type VARCHAR(20) NOT NULL, -- post, comment, review
  target_id UUID NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, target_type, target_id)
);

-- ãƒ•ã‚©ãƒ­ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE follows (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  follower_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  following_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(follower_id, following_id),
  CHECK(follower_id != following_id)
);

-- èª­æ›¸ãƒªã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE reading_lists (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  is_public BOOLEAN DEFAULT FALSE,
  is_collaborative BOOLEAN DEFAULT FALSE,
  book_ids JSONB DEFAULT '[]', -- æ›¸ç±IDã®é…åˆ—
  order_index INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- é€šçŸ¥ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  type VARCHAR(50) NOT NULL, -- new_follower, new_comment, reading_goal_achieved, etc.
  title VARCHAR(200) NOT NULL,
  message TEXT,
  data JSONB DEFAULT '{}', -- è¿½åŠ ãƒ‡ãƒ¼ã‚¿
  is_read BOOLEAN DEFAULT FALSE,
  action_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_reading_records_user_status ON reading_records(user_id, status);
CREATE INDEX idx_reading_records_last_read ON reading_records(last_read_at DESC);
CREATE INDEX idx_blog_posts_published ON blog_posts(published_at DESC) WHERE status = 'published';
CREATE INDEX idx_blog_posts_tags ON blog_posts USING GIN(tags);
CREATE INDEX idx_books_genre ON books USING GIN(genre);
CREATE INDEX idx_comments_post_created ON comments(post_id, created_at DESC);
CREATE INDEX idx_notifications_user_unread ON notifications(user_id, is_read, created_at DESC);
```

### TypeScriptå‹å®šç¾©

```typescript
// types/database.ts
export interface User {
  id: string;
  email: string;
  username: string;
  displayName: string;
  avatarUrl?: string;
  bio?: string;
  readingGoalBooksPerMonth: number;
  readingGoalPagesPerDay: number;
  preferredGenres: string[];
  readingLevel: 'beginner' | 'intermediate' | 'advanced';
  createdAt: Date;
  updatedAt: Date;
}

export interface Book {
  id: string;
  isbn?: string;
  title: string;
  subtitle?: string;
  authors: string[];
  publisher?: string;
  publishedDate?: Date;
  pageCount?: number;
  genre: string[];
  language: string;
  coverImageUrl?: string;
  coverImageColors: string[];
  description?: string;
  averageRating?: number;
  ratingCount: number;
  goodreadsId?: string;
  amazonUrl?: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface ReadingRecord {
  id: string;
  userId: string;
  bookId: string;
  status: 'want_to_read' | 'reading' | 'finished' | 'abandoned';
  currentPage: number;
  totalPages?: number;
  userRating?: number;
  review?: string;
  readingStartedAt?: Date;
  readingFinishedAt?: Date;
  lastReadAt?: Date;
  readingSessions: ReadingSession[];
  notes: BookNote[];
  bookmarks: BookBookmark[];
  favoriteQuotes: FavoriteQuote[];
  createdAt: Date;
  updatedAt: Date;
  book?: Book; // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
}

export interface ReadingSession {
  startedAt: Date;
  endedAt: Date;
  pagesRead: number;
  location?: string; // èª­æ›¸å ´æ‰€
  mood?: string; // èª­æ›¸æ™‚ã®æ°—åˆ†
}

export interface BookNote {
  page: number;
  content: string;
  createdAt: Date;
  highlight?: string; // ãƒã‚¤ãƒ©ã‚¤ãƒˆã—ãŸãƒ†ã‚­ã‚¹ãƒˆ
}

export interface BookBookmark {
  page: number;
  title?: string;
  createdAt: Date;
}

export interface FavoriteQuote {
  page: number;
  text: string;
  context?: string; // å‰å¾Œã®æ–‡è„ˆ
  createdAt: Date;
}

export interface BlogPost {
  id: string;
  authorId: string;
  title: string;
  slug: string;
  content: string; // MDX content
  excerpt?: string;
  featuredImageUrl?: string;
  featuredImageAlt?: string;
  status: 'draft' | 'published' | 'archived';
  publishedAt?: Date;
  readingTimeMinutes?: number;
  viewCount: number;
  likeCount: number;
  commentCount: number;
  tags: string[];
  categories: string[];
  relatedBooks: string[]; // Book IDs
  seoTitle?: string;
  seoDescription?: string;
  ogpImageUrl?: string;
  createdAt: Date;
  updatedAt: Date;
  author?: User; // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  comments?: Comment[]; // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
}

export interface Comment {
  id: string;
  postId: string;
  authorId: string;
  parentId?: string;
  content: string;
  isApproved: boolean;
  likeCount: number;
  createdAt: Date;
  updatedAt: Date;
  author?: User; // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  replies?: Comment[]; // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
}

export interface ReadingList {
  id: string;
  userId: string;
  name: string;
  description?: string;
  isPublic: boolean;
  isCollaborative: boolean;
  bookIds: string[];
  orderIndex: number;
  createdAt: Date;
  updatedAt: Date;
  user?: User; // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  books?: Book[]; // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
}

export interface Notification {
  id: string;
  userId: string;
  type: string;
  title: string;
  message?: string;
  data: Record<string, any>;
  isRead: boolean;
  actionUrl?: string;
  createdAt: Date;
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

```typescript
// lib/error-handling.ts
export class KawaiiError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode: number = 500,
    public userMessage?: string,
    public context?: Record<string, any>
  ) {
    super(message);
    this.name = 'KawaiiError';
  }
}

// ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥å®šç¾©
export const ErrorCodes = {
  // èªè¨¼ã‚¨ãƒ©ãƒ¼
  AUTH_REQUIRED: 'AUTH_REQUIRED',
  AUTH_INVALID: 'AUTH_INVALID',
  AUTH_EXPIRED: 'AUTH_EXPIRED',
  
  // èª­æ›¸è¨˜éŒ²ã‚¨ãƒ©ãƒ¼
  BOOK_NOT_FOUND: 'BOOK_NOT_FOUND',
  READING_RECORD_NOT_FOUND: 'READING_RECORD_NOT_FOUND',
  INVALID_PAGE_NUMBER: 'INVALID_PAGE_NUMBER',
  READING_ALREADY_FINISHED: 'READING_ALREADY_FINISHED',
  
  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒ©ãƒ¼
  POST_NOT_FOUND: 'POST_NOT_FOUND',
  CONTENT_VALIDATION_FAILED: 'CONTENT_VALIDATION_FAILED',
  IMAGE_UPLOAD_FAILED: 'IMAGE_UPLOAD_FAILED',
  
  // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼
  DATABASE_ERROR: 'DATABASE_ERROR',
  EXTERNAL_API_ERROR: 'EXTERNAL_API_ERROR',
  RATE_LIMIT_EXCEEDED: 'RATE_LIMIT_EXCEEDED',
} as const;

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
export const handleApiError = (error: unknown): Response => {
  console.error('API Error:', error);

  if (error instanceof KawaiiError) {
    return NextResponse.json(
      {
        error: true,
        code: error.code,
        message: error.userMessage || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
        ...(process.env.NODE_ENV === 'development' && {
          details: error.message,
          context: error.context,
        }),
      },
      { status: error.statusCode }
    );
  }

  if (error instanceof z.ZodError) {
    return NextResponse.json(
      {
        error: true,
        code: 'VALIDATION_ERROR',
        message: 'å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“',
        details: error.errors,
      },
      { status: 400 }
    );
  }

  // äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼
  return NextResponse.json(
    {
      error: true,
      code: 'INTERNAL_ERROR',
      message: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾Œã§ãŠè©¦ã—ãã ã•ã„ã€‚',
    },
    { status: 500 }
  );
};

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
export const useErrorHandler = () => {
  const [error, setError] = useState<string | null>(null);

  const handleError = useCallback((error: unknown) => {
    if (error instanceof KawaiiError) {
      setError(error.userMessage || error.message);
    } else if (error instanceof Error) {
      setError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    } else {
      setError('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }

    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°é€ä¿¡
    if (process.env.NODE_ENV === 'production') {
      // Sentryãªã©ã«ã‚¨ãƒ©ãƒ¼ã‚’é€ä¿¡
      console.error('Client Error:', error);
    }
  }, []);

  const clearError = useCallback(() => {
    setError(null);
  }, []);

  return { error, handleError, clearError };
};
```

### ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// components/kawaii/KawaiiErrorBoundary.tsx
interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

export class KawaiiErrorBoundary extends Component<
  { children: ReactNode; fallback?: ReactNode },
  ErrorBoundaryState
> {
  constructor(props: { children: ReactNode; fallback?: ReactNode }) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Error Boundary caught an error:', error, errorInfo);
    // ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-pink-50 to-blue-50">
          <KawaiiCard className="max-w-md mx-auto text-center">
            <div className="mb-6">
              <div className="text-6xl mb-4">ğŸ˜…</div>
              <h2 className="text-xl font-semibold text-neutral-800 mb-2">
                ãŠã£ã¨ï¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ
              </h2>
              <p className="text-neutral-600">
                ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚äºˆæœŸã—ãªã„å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
                ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚
              </p>
            </div>
            <KawaiiButton
              onClick={() => window.location.reload()}
              className="w-full"
            >
              ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿
            </KawaiiButton>
          </KawaiiCard>
        </div>
      );
    }

    return this.props.children;
  }
}

// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
export const KawaiiErrorMessage: React.FC<{
  message: string;
  onRetry?: () => void;
  className?: string;
}> = ({ message, onRetry, className = '' }) => {
  return (
    <motion.div
      className={cn(
        'bg-red-50 border border-red-200 rounded-lg p-4',
        'flex items-center gap-3',
        className
      )}
      initial={{ opacity: 0, scale: 0.95 }}
      animate={{ opacity: 1, scale: 1 }}
      transition={{ duration: 0.2 }}
    >
      <div className="text-red-400 text-xl">âš ï¸</div>
      <div className="flex-1">
        <p className="text-red-800 text-sm">{message}</p>
      </div>
      {onRetry && (
        <KawaiiButton
          size="sm"
          variant="secondary"
          onClick={onRetry}
        >
          å†è©¦è¡Œ
        </KawaiiButton>
      )}
    </motion.div>
  );
};
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### èªè¨¼ãƒ»èªå¯

```typescript
// lib/auth/middleware.ts
export const authMiddleware = async (req: NextRequest) => {
  const token = req.cookies.get('auth-token')?.value;
  
  if (!token) {
    throw new KawaiiError(
      'Authentication required',
      ErrorCodes.AUTH_REQUIRED,
      401,
      'ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™'
    );
  }

  try {
    const payload = await jwt.verify(token, process.env.JWT_SECRET!);
    return payload as JWTPayload;
  } catch (error) {
    throw new KawaiiError(
      'Invalid token',
      ErrorCodes.AUTH_INVALID,
      401,
      'èªè¨¼æƒ…å ±ãŒç„¡åŠ¹ã§ã™'
    );
  }
};

// APIä¿è­·
export const withAuth = (handler: (req: NextRequest, user: User) => Promise<Response>) => {
  return async (req: NextRequest) => {
    try {
      const user = await authMiddleware(req);
      return await handler(req, user);
    } catch (error) {
      return handleApiError(error);
    }
  };
};
```

### ãƒ‡ãƒ¼ã‚¿ä¿è­·

```typescript
// lib/security/validation.ts
export const bookValidationSchema = z.object({
  title: z.string().min(1, 'æ›¸ç±ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™').max(500, 'ã‚¿ã‚¤ãƒˆãƒ«ãŒé•·ã™ãã¾ã™'),
  authors: z.array(z.string()).min(1, 'è‘—è€…ã¯å¿…é ˆã§ã™'),
  isbn: z.string().regex(/^[\d-]+$/, 'ISBNã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“').optional(),
  pageCount: z.number().min(1, 'ãƒšãƒ¼ã‚¸æ•°ã¯1ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™').optional(),
  genre: z.array(z.string()).max(10, 'ã‚¸ãƒ£ãƒ³ãƒ«ã¯10å€‹ã¾ã§ã§ã™'),
  description: z.string().max(2000, 'èª¬æ˜æ–‡ãŒé•·ã™ãã¾ã™').optional(),
});

export const readingRecordValidationSchema = z.object({
  bookId: z.string().uuid('ç„¡åŠ¹ãªæ›¸ç±IDã§ã™'),
  status: z.enum(['want_to_read', 'reading', 'finished', 'abandoned']),
  currentPage: z.number().min(0, 'ãƒšãƒ¼ã‚¸æ•°ã¯0ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™'),
  userRating: z.number().min(1).max(5).optional(),
  review: z.string().max(2000, 'ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒé•·ã™ãã¾ã™').optional(),
});

export const blogPostValidationSchema = z.object({
  title: z.string().min(1, 'ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™').max(200, 'ã‚¿ã‚¤ãƒˆãƒ«ãŒé•·ã™ãã¾ã™'),
  content: z.string().min(10, 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯10æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™'),
  excerpt: z.string().max(300, 'è¦ç´„ãŒé•·ã™ãã¾ã™').optional(),
  tags: z.array(z.string()).max(10, 'ã‚¿ã‚°ã¯10å€‹ã¾ã§ã§ã™'),
  categories: z.array(z.string()).max(5, 'ã‚«ãƒ†ã‚´ãƒªã¯5å€‹ã¾ã§ã§ã™'),
});

// XSSä¿è­·
export const sanitizeHtml = (html: string): string => {
  return DOMPurify.sanitize(html, {
    ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'u', 'ul', 'ol', 'li', 'blockquote'],
    ALLOWED_ATTR: [],
  });
};

// CSRFãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
export const generateCSRFToken = (): string => {
  return crypto.randomBytes(32).toString('hex');
};

// ãƒ¬ãƒ¼ãƒˆåˆ¶é™
export const rateLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†
  max: 100, // ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™
  message: {
    error: true,
    code: ErrorCodes.RATE_LIMIT_EXCEEDED,
    message: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã¾ã™ã€‚ã—ã°ã‚‰ãå¾Œã§ãŠè©¦ã—ãã ã•ã„ã€‚',
  },
});
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æˆ¦ç•¥

```typescript
// lib/performance/optimization.ts

// ç”»åƒæœ€é©åŒ–è¨­å®š
export const imageOptimizationConfig = {
  formats: ['image/avif', 'image/webp', 'image/jpeg'],
  deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  quality: 75,
  // ã‹ã‚ã„ã„ç”»åƒã®é«˜å“è³ªè¡¨ç¤º
  bookCoverQuality: 90,
  illustrationQuality: 85,
};

// Critical CSSæŠ½å‡º
export const extractCriticalCSS = async (html: string): Promise<string> => {
  const critical = await generateCritical({
    html,
    css: await readFile('dist/styles.css', 'utf8'),
    dimensions: [
      { width: 320, height: 568 }, // Mobile
      { width: 768, height: 1024 }, // Tablet
      { width: 1920, height: 1080 }, // Desktop
    ],
    ignore: {
      atrule: ['@font-face'],
    },
  });
  return critical;
};

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé…å»¶èª­ã¿è¾¼ã¿
export const LazyComponents = {
  BookGallery: dynamic(() => import('@/components/books/BookGallery'), {
    loading: () => <BookGallerySkeleton />,
    ssr: false,
  }),
  
  ReadingChart: dynamic(() => import('@/components/reading/ReadingChart'), {
    loading: () => <ChartSkeleton />,
    ssr: false,
  }),
  
  AnimatedBackground: dynamic(() => import('@/components/kawaii/AnimatedBackground'), {
    loading: () => null,
    ssr: false,
  }),
};

// ãƒ¡ãƒ¢åŒ–ãƒ•ãƒƒã‚¯
export const useOptimizedBookData = (bookId: string) => {
  return useQuery({
    queryKey: ['book', bookId],
    queryFn: () => fetchBookData(bookId),
    staleTime: 5 * 60 * 1000, // 5åˆ†
    cacheTime: 30 * 60 * 1000, // 30åˆ†
    refetchOnWindowFocus: false,
  });
};

// ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
export const VirtualBookList: React.FC<{ books: Book[] }> = ({ books }) => {
  const { List, scrollToIndex } = useVirtualizer({
    count: books.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 280, // ã‚«ãƒ¼ãƒ‰ã®æ¨å®šé«˜ã•
    overscan: 5,
  });

  return (
    <div ref={parentRef} className="h-96 overflow-auto">
      <div style={{ height: List.getTotalSize(), width: '100%', position: 'relative' }}>
        {List.getVirtualItems().map((virtualItem) => (
          <BookCard
            key={virtualItem.index}
            book={books[virtualItem.index]}
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              width: '100%',
              transform: `translateY(${virtualItem.start}px)`,
            }}
          />
        ))}
      </div>
    </div>
  );
};
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

```typescript
// lib/cache/strategies.ts

// Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
export const cacheConfig = {
  // æ›¸ç±ãƒ‡ãƒ¼ã‚¿: é•·æœŸã‚­ãƒ£ãƒƒã‚·ãƒ¥
  bookData: {
    ttl: 24 * 60 * 60, // 24æ™‚é–“
    key: (id: string) => `book:${id}`,
  },
  
  // èª­æ›¸è¨˜éŒ²: ä¸­æœŸã‚­ãƒ£ãƒƒã‚·ãƒ¥
  readingRecords: {
    ttl: 60 * 60, // 1æ™‚é–“
    key: (userId: string) => `reading:${userId}`,
  },
  
  // ãƒ–ãƒ­ã‚°è¨˜äº‹: çŸ­æœŸã‚­ãƒ£ãƒƒã‚·ãƒ¥
  blogPosts: {
    ttl: 15 * 60, // 15åˆ†
    key: (slug: string) => `post:${slug}`,
  },
  
  // æ¤œç´¢çµæœ: çŸ­æœŸã‚­ãƒ£ãƒƒã‚·ãƒ¥
  searchResults: {
    ttl: 5 * 60, // 5åˆ†
    key: (query: string) => `search:${hashQuery(query)}`,
  },
};

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
export class CacheManager {
  private redis: Redis;

  constructor() {
    this.redis = new Redis(process.env.REDIS_URL!);
  }

  async get<T>(key: string): Promise<T | null> {
    try {
      const cached = await this.redis.get(key);
      return cached ? JSON.parse(cached) : null;
    } catch (error) {
      console.error('Cache get error:', error);
      return null;
    }
  }

  async set(key: string, value: any, ttl?: number): Promise<void> {
    try {
      const serialized = JSON.stringify(value);
      if (ttl) {
        await this.redis.setex(key, ttl, serialized);
      } else {
        await this.redis.set(key, serialized);
      }
    } catch (error) {
      console.error('Cache set error:', error);
    }
  }

  async invalidate(pattern: string): Promise<void> {
    try {
      const keys = await this.redis.keys(pattern);
      if (keys.length > 0) {
        await this.redis.del(...keys);
      }
    } catch (error) {
      console.error('Cache invalidation error:', error);
    }
  }
}

// ISRè¨­å®š
export const revalidationConfig = {
  // é™çš„ãƒšãƒ¼ã‚¸ã®å†ç”Ÿæˆé–“éš”
  homepage: 3600, // 1æ™‚é–“
  blogPost: 1800, // 30åˆ†
  authorPage: 7200, // 2æ™‚é–“
  bookPage: 86400, // 24æ™‚é–“
};
```

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

```typescript
// tests/components/KawaiiButton.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { KawaiiButton } from '@/components/kawaii/KawaiiButton';

describe('KawaiiButton', () => {
  it('åŸºæœ¬çš„ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°', () => {
    render(<KawaiiButton>ã‚¯ãƒªãƒƒã‚¯</KawaiiButton>);
    expect(screen.getByText('ã‚¯ãƒªãƒƒã‚¯')).toBeInTheDocument();
  });

  it('ãƒ›ãƒãƒ¼æ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã‚‹', async () => {
    render(<KawaiiButton>ãƒ›ãƒãƒ¼</KawaiiButton>);
    const button = screen.getByText('ãƒ›ãƒãƒ¼');
    
    fireEvent.mouseEnter(button);
    await waitFor(() => {
      expect(button).toHaveStyle('transform: scale(1.05) translateY(-2px)');
    });
  });

  it('ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<KawaiiButton loading>èª­ã¿è¾¼ã¿ä¸­</KawaiiButton>);
    expect(screen.getByText('èª­ã¿è¾¼ã¿ä¸­')).toBeInTheDocument();
    expect(screen.getByRole('button')).toBeDisabled();
  });

  it('ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒæ­£ã—ãå‹•ä½œã™ã‚‹', () => {
    const handleClick = vi.fn();
    render(<KawaiiButton onClick={handleClick}>ã‚¯ãƒªãƒƒã‚¯</KawaiiButton>);
    
    fireEvent.click(screen.getByText('ã‚¯ãƒªãƒƒã‚¯'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });
});

// tests/hooks/useReadingProgress.test.ts
import { renderHook, act } from '@testing-library/react';
import { useReadingProgress } from '@/hooks/useReadingProgress';

describe('useReadingProgress', () => {
  it('èª­æ›¸é€²æ—ã®æ›´æ–°', async () => {
    const { result } = renderHook(() => useReadingProgress('book-1'));
    
    await act(async () => {
      await result.current.updateProgress(150, 300);
    });
    
    expect(result.current.progress).toBe(50);
    expect(result.current.currentPage).toBe(150);
  });

  it('ç„¡åŠ¹ãªãƒšãƒ¼ã‚¸æ•°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹', async () => {
    const { result } = renderHook(() => useReadingProgress('book-1'));
    
    await act(async () => {
      await expect(
        result.current.updateProgress(-1, 300)
      ).rejects.toThrow('ç„¡åŠ¹ãªãƒšãƒ¼ã‚¸æ•°ã§ã™');
    });
  });
});

// tests/api/reading-records.test.ts
import { createMocks } from 'node-mocks-http';
import handler from '@/pages/api/reading-records';

describe('/api/reading-records', () => {
  it('GET: èª­æ›¸è¨˜éŒ²ã®å–å¾—', async () => {
    const { req, res } = createMocks({
      method: 'GET',
      headers: {
        authorization: 'Bearer valid-token',
      },
    });

    await handler(req, res);

    expect(res._getStatusCode()).toBe(200);
    const data = JSON.parse(res._getData());
    expect(Array.isArray(data.records)).toBe(true);
  });

  it('POST: æ–°ã—ã„èª­æ›¸è¨˜éŒ²ã®ä½œæˆ', async () => {
    const { req, res } = createMocks({
      method: 'POST',
      headers: {
        authorization: 'Bearer valid-token',
        'content-type': 'application/json',
      },
      body: {
        bookId: 'book-123',
        status: 'reading',
        currentPage: 0,
      },
    });

    await handler(req, res);

    expect(res._getStatusCode()).toBe(201);
    const data = JSON.parse(res._getData());
    expect(data.record.bookId).toBe('book-123');
  });
});
```

### E2Eãƒ†ã‚¹ãƒˆ

```typescript
// tests/e2e/reading-flow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('èª­æ›¸è¨˜éŒ²ãƒ•ãƒ­ãƒ¼', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/login');
    await page.fill('[data-testid=email]', 'test@example.com');
    await page.fill('[data-testid=password]', 'password');
    await page.click('[data-testid=login-button]');
    await page.waitForURL('/dashboard');
  });

  test('æœ¬ã‚’æ¤œç´¢ã—ã¦èª­æ›¸è¨˜éŒ²ã«è¿½åŠ ', async ({ page }) => {
    // æœ¬ã‚’æ¤œç´¢
    await page.fill('[data-testid=search-box]', 'å¾è¼©ã¯çŒ«ã§ã‚ã‚‹');
    await page.press('[data-testid=search-box]', 'Enter');
    
    // æ¤œç´¢çµæœã‚’ç¢ºèª
    await expect(page.locator('[data-testid=search-results]')).toBeVisible();
    await expect(page.locator('[data-testid=book-card]').first()).toContainText('å¾è¼©ã¯çŒ«ã§ã‚ã‚‹');
    
    // æœ¬ã‚’èª­æ›¸ãƒªã‚¹ãƒˆã«è¿½åŠ 
    await page.click('[data-testid=add-to-reading] >> nth=0');
    await page.waitForSelector('[data-testid=success-toast]');
    
    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç¢ºèª
    await page.goto('/dashboard');
    await expect(page.locator('[data-testid=currently-reading]')).toContainText('å¾è¼©ã¯çŒ«ã§ã‚ã‚‹');
  });

  test('èª­æ›¸é€²æ—ã®æ›´æ–°ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³', async ({ page }) => {
    await page.goto('/books/wagahai-wa-neko-de-aru');
    
    // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°
    await page.fill('[data-testid=current-page-input]', '50');
    await page.click('[data-testid=update-progress-button]');
    
    // é€²æ—ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
    await expect(page.locator('[data-testid=progress-bar]')).toHaveCSS('width', /^(?!0px)/);
    
    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    await expect(page.locator('[data-testid=progress-updated-animation]')).toBeVisible();
    
    // çµ±è¨ˆã®æ›´æ–°ã‚’ç¢ºèª
    await page.goto('/dashboard');
    await expect(page.locator('[data-testid=pages-read-today]')).toContainText('50');
  });

  test('ã‹ã‚ã„ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å‹•ä½œç¢ºèª', async ({ page }) => {
    await page.goto('/dashboard');
    
    // ã„ã„ã­ãƒœã‚¿ãƒ³ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    await page.click('[data-testid=like-button] >> nth=0');
    await expect(page.locator('[data-testid=heart-particles]')).toBeVisible();
    
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    await page.click('[data-testid=load-more-books]');
    await expect(page.locator('[data-testid=kawaii-loading]')).toBeVisible();
    
    // ãƒšãƒ¼ã‚¸é·ç§»ã®ãµã‚ãµã‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    await page.click('[data-testid=book-card] >> nth=0');
    await page.waitForURL(/\/books\/.+/);
    await expect(page.locator('[data-testid=book-detail]')).toHaveCSS('opacity', '1');
  });
});

// tests/e2e/mobile-experience.spec.ts
import { test, expect, devices } from '@playwright/test';

test.use({ ...devices['iPhone 12'] });

test.describe('ãƒ¢ãƒã‚¤ãƒ«ä½“é¨“', () => {
  test('ã‚¿ãƒƒãƒæ“ä½œã¨ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³', async ({ page }) => {
    await page.goto('/');
    
    // ãƒ¢ãƒã‚¤ãƒ«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª
    await page.click('[data-testid=mobile-menu-button]');
    await expect(page.locator('[data-testid=mobile-menu]')).toBeVisible();
    
    // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã®ç¢ºèª
    const bookCard = page.locator('[data-testid=book-card] >> nth=0');
    await bookCard.hover();
    await bookCard.swipe({ direction: 'left' });
    await expect(page.locator('[data-testid=book-actions]')).toBeVisible();
    
    // ã‚¿ãƒƒãƒãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®ç¢ºèª
    await page.tap('[data-testid=kawaii-button]');
    await expect(page.locator('[data-testid=kawaii-button]')).toHaveCSS('transform', /scale/);
  });

  test('ç”»åƒã®é…å»¶èª­ã¿è¾¼ã¿', async ({ page }) => {
    await page.goto('/books');
    
    // åˆæœŸè¡¨ç¤ºæ™‚ã¯ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„
    const images = page.locator('[data-testid=book-cover-image]');
    await expect(images.first()).not.toBeVisible();
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹
    await page.evaluate(() => window.scrollTo(0, 1000));
    await expect(images.first()).toBeVisible();
  });
});
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

```typescript
// tests/performance/lighthouse.test.ts
import { test } from '@playwright/test';
import { playAudit } from 'playwright-lighthouse';

test.describe('Lighthouse ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£æŸ»', () => {
  test('ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹', async ({ page }) => {
    await page.goto('/');
    
    await playAudit({
      page,
      thresholds: {
        performance: 90,
        accessibility: 95,
        'best-practices': 90,
        seo: 95,
        pwa: 80,
      },
      port: 9222,
    });
  });

  test('èª­æ›¸ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹', async ({ page }) => {
    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    await page.goto('/login');
    await page.fill('[data-testid=email]', 'test@example.com');
    await page.fill('[data-testid=password]', 'password');
    await page.click('[data-testid=login-button]');
    
    await page.goto('/dashboard');
    
    await playAudit({
      page,
      thresholds: {
        performance: 85, // å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è€ƒæ…®ã—ã¦å°‘ã—ä½ã‚ã«è¨­å®š
        accessibility: 95,
        'best-practices': 90,
        seo: 90,
      },
      port: 9222,
    });
  });
});

// tests/performance/animation-performance.test.ts
test.describe('ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹', () => {
  test('60FPSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª', async ({ page }) => {
    await page.goto('/dashboard');
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–é–‹å§‹
    await page.evaluate(() => {
      (window as any).performanceData = [];
      const observer = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          (window as any).performanceData.push(entry);
        }
      });
      observer.observe({ entryTypes: ['paint', 'layout-shift'] });
    });
    
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼
    await page.click('[data-testid=like-button]');
    await page.waitForTimeout(2000); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ã¾ã§å¾…æ©Ÿ
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const performanceData = await page.evaluate(() => (window as any).performanceData);
    
    // CLSï¼ˆCumulative Layout Shiftï¼‰ãŒè¨±å®¹ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
    const clsEntries = performanceData.filter((entry: any) => entry.entryType === 'layout-shift');
    const totalCLS = clsEntries.reduce((sum: number, entry: any) => sum + entry.value, 0);
    
    expect(totalCLS).toBeLessThan(0.1); // CLS < 0.1 (Good)
  });
});
```

ã“ã®ã‚ˆã†ã«ã€ã‹ã‚ã„ã„èª­æ›¸ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®åŒ…æ‹¬çš„ãªæŠ€è¡“è¨­è¨ˆã‚’ç­–å®šã—ã¾ã—ãŸã€‚Next.js 15ã¨React 19ã‚’åŸºç›¤ã¨ã—ã€è¦ä»¶ã§æ±‚ã‚ã‚‰ã‚ŒãŸã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã€èª­æ›¸è¨˜éŒ²è¿½è·¡ã€ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½ãªã©ã™ã¹ã¦ã‚’å®Ÿç¾ã™ã‚‹è©³ç´°ãªè¨­è¨ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯è¦ä»¶å®šç¾©æ›¸ã®å—å…¥åŸºæº–ã‚’æº€ãŸã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚‚è€ƒæ…®ã—ãŸå®Ÿè£…å¯èƒ½ãªè¨­è¨ˆæ›¸ã§ã™ã€‚