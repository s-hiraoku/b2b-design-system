# CC-Deck Base Workflow Specifications

このドキュメントでは、CC-Deck Workflow Engineの基本ワークフロー（`.cc-deck/config/workflows/base/`）について説明します。

## 概要

CC-Deck Workflow Engineは、仕様駆動開発（Kiro SDD）プロセスを実現するための7つの基本ワークフローを提供します。各ワークフローは独立して実行可能で、適切な順序で連携することで完全な開発サイクルを実現します。

## 基本ワークフロー一覧

### 1. acceptance.yaml - 受入れワークフロー
**目的**: 人間による承認プロセスとフィードバック分析による開発フェーズの自動再実行

**主要フェーズ**:
- **review_preparation**: 包括的なレビュー資料の準備
- **human_review**: 構造化された人間レビューと承認プロセス  
- **decision_processing**: 承認決定の処理と適切なアクションへのルーティング
- **feedback_analysis**: 拒否フィードバックの分析と根本原因の特定
- **phase_coordination**: 開発フェーズのロールバックと再実行の調整
- **acceptance_completion**: 受入れプロセスの完了と結果の文書化

**特徴**:
- 72時間のレビュータイムアウトとエスカレーション機能
- フィードバック分析による自動的な問題分類
- フェーズ別ロールバック戦略
- 品質向上の追跡とメトリクス収集

### 2. coding.yaml - 開発ワークフロー
**目的**: MCP統合とスマートコンテキスト伝播を含む完全な開発ワークフロー

**主要フェーズ**:
- **research**: MCP統合を使用した技術調査
- **planning**: アーキテクチャと実装戦略の開発
- **serena_onboarding**: Serena MCPの初期化とTDD環境の構築
- **tdd_cycle**: t-wada手法によるTDDサイクルの厳格な実行
- **full_implementation**: 包括的MCP統合によるエンタープライズグレード実装
- **testing**: 包括的テスト戦略
- **documentation**: 包括的ドキュメントの生成

**特徴**:
- DeepWiki、Context7、Serenaとの多重MCP統合
- 強制TDD-Firstアプローチ（95%以上のテストカバレッジ）
- リアルタイム品質保証とモニタリング
- マルチエージェント協調実行
- 包括的エラーハンドリングとリカバリ

### 3. dev-env-setup.yaml - 開発環境セットアップワークフロー
**目的**: プロジェクト固有の開発最適化のための動的MCPエージェント生成

**主要フェーズ**:
- **spec_analysis**: Kiro SDD仕様の分析と技術スタックの抽出
- **mcp_recommendation**: プロジェクト技術スタックに最適なMCPエージェントの調査と推奨
- **user_approval**: 推奨MCPエージェントの人間による承認
- **agent_generation**: 承認されたMCP SubAgentの動的生成
- **workflow_integration**: 基本Codingワークフローとの拡張設定の統合

**特徴**:
- Brave Search、DeepWiki、Context7による動的MCP調査
- プロジェクト固有のエージェント生成とネーミング規則
- ワークフロー拡張による既存システムとのシームレス統合
- グレースフル劣化戦略

### 4. kiro-sdd.yaml - Kiro SDD仕様駆動開発ワークフロー
**目的**: 仕様駆動開発プロセスの完全な実装（ステアリングから実装まで）

**主要フェーズ**:
- **steering**: プロジェクトステアリングドキュメントの生成・更新
- **init**: 仕様ディレクトリとメタデータの初期化
- **requirements**: EARS形式による包括的要件定義
- **design**: 承認された要件に基づく包括的技術設計
- **tasks**: 設計に基づく詳細実装タスクの生成
- **implementation**: 進捗追跡付きタスク駆動実装
- **validation**: 完了の検証とプロジェクトステータスの更新

**特徴**:
- tasks.mdファイルとの統合による進捗追跡
- 各フェーズでの人間承認要件
- 依存関係を意識したタスク実行戦略
- 品質ゲートと検証システム

### 5. pr.yaml - プルリクエストワークフロー
**目的**: 包括的検証と人間承認を含む完全なプルリクエストワークフロー

**主要フェーズ**:
- **pr_analysis**: コード変更の分析とPR作成のためのインパクト評価
- **pr_content_generation**: 変更分析に基づく高品質PRコンテンツの生成
- **pr_validation**: PR品質とレビュー準備状況の検証
- **pr_creation**: 生成されたコンテンツとメタデータでのプルリクエスト作成
- **merge_preparation**: マージ準備と人間承認プロセスの促進
- **pr_merge**: 検証付き安全なプルリクエストマージの実行
- **post_merge_activities**: マージ後のクリーンアップと通知処理

**特徴**:
- 自動レビュアー割り当てとラベル適用
- 複数マージ戦略（squash、merge commit、rebase）
- CI/CD統合とステータスチェック
- 緊急マージとホットフィックス対応

### 6. refactoring.yaml - リファクタリングワークフロー
**目的**: セマンティック分析とパターン検出による体系的コードリファクタリング

**主要フェーズ**:
- **pattern_analysis**: 重複と類似コードパターンの特定
- **code_analysis**: コード構造と依存関係の分析
- **refactoring_selection**: 適切なリファクタリングアプローチの選択
- **serena_refactoring/similarity_refactoring/standard_refactoring**: 選択されたアプローチによるリファクタリング実行
- **quality_validation**: リファクタリング結果と品質改善の検証

**特徴**:
- Serena MCPによるセマンティックリファクタリング
- 類似パターン分析による重複コード排除
- 機能保持とパフォーマンスインパクトの検証
- 品質メトリクスによる改善度測定

### 7. testing.yaml - テストワークフロー
**目的**: 統合テストとE2Eテストオーケストレーションによる包括的テストワークフロー

**主要フェーズ**:
- **strategy_planning**: プロジェクト仕様に基づく包括的テスト戦略の開発
- **environment_setup**: テスト環境のセットアップと設定
- **test_type_selection**: プロジェクトニーズに基づく適切なテストアプローチの選択
- **integration_testing/e2e_testing**: 包括的な統合テストまたはエンドツーエンドテスト
- **test_reporting**: 包括的テストレポートと分析の生成

**特徴**:
- PlaywrightとCypressによるE2Eテストフレームワーク対応
- 統合テスト、APIテスト、パフォーマンステストの包括的実行
- 85%以上のテストカバレッジ要件
- リアルタイム品質ゲートとパフォーマンスベンチマーク

## ワークフロー連携

### 標準的な実行順序
1. **kiro-sdd** → プロジェクト仕様の作成
2. **dev-env-setup** → 開発環境の最適化
3. **coding** → TDD実装
4. **refactoring** → コード品質向上（条件付き）
5. **testing** → 包括的テスト
6. **pr** → プルリクエスト管理
7. **acceptance** → 最終承認と品質保証

### Smart Context Propagation
各ワークフローは前のワークフローからコンテキストを継承し、結果を次のワークフローに引き継ぎます：
- プロジェクトメタデータ
- 技術スタック情報
- 品質メトリクス
- テスト結果
- 承認履歴

## 共通機能

### Human Approval Checkpoints
全てのワークフローには人間承認チェックポイントが組み込まれ、以下を保証します：
- 品質基準の遵守
- ステークホルダー要件の満足
- プロセス完了の検証
- フィードバック収集とプロセス改善

### エラーハンドリング
各ワークフローには以下が含まれます：
- リトライポリシーと指数バックオフ
- 回復戦略と代替アプローチ
- サーキットブレーカーパターン
- チェックポイントシステム

### 監視とアナリティクス
リアルタイム監視により以下を追跡：
- フェーズパフォーマンスメトリクス
- 品質改善指標
- エラー率と回復時間
- 人間承認レスポンス時間
- リソース使用量

### 品質ゲート
各ワークフローには以下の品質基準が定義されています：
- コード品質閾値
- テストカバレッジ要件
- パフォーマンスベンチマーク
- セキュリティ基準
- ドキュメント完全性

## MCP統合

### 統合されたMCPサーバー
- **DeepWiki MCP**: GitHubリポジトリ分析とパターン抽出
- **Context7 MCP**: ライブラリドキュメントとAPIリファレンス
- **Serena MCP**: セマンティックコード分析とTDD支援
- **Brave Search MCP**: 最新のベストプラクティスと技術調査

### フォールバック戦略
各MCPサービスには、サービス障害時の代替手段が定義されています：
- キャッシュされたドキュメントへのフォールバック
- 代替MCPサービスの使用
- ローカル分析モードへの切り替え
- グレースフル劣化による継続性保証

## カスタマイゼーション

### プロジェクト固有の調整
- 品質ゲート閾値の調整
- 承認要件の変更
- エージェント選択ルールのカスタマイズ
- 並列実行設定の最適化

### 環境別設定
- 開発環境向け緩和設定
- 本番環境向け厳格設定
- CI/CD統合設定
- モニタリングとアラート設定

このワークフローシステムにより、CC-Deck Workflow Engineは一貫した高品質な開発プロセスを提供し、プロジェクトの成功と継続的な改善を支援します。