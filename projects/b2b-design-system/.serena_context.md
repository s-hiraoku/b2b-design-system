# Serena MCP Context - B2B Design System (TDD Mode)

## Project Overview

**Project Name**: B2B Design System  
**Type**: Enterprise-grade React component library  
**Development Mode**: Test-Driven Development (TDD)  
**Technology Stack**: React 18.3+, TypeScript 5.3+, Tailwind CSS 3.4+, shadcn/ui, Storybook 7.6+, Vite 5+  
**Implementation Tasks**: 42 tasks across 10 phases  
**Coverage Requirement**: 90%+ test coverage with WCAG 2.1 AA compliance  

## TDD Configuration & Standards

### Development Philosophy
- **Strict TDD Enforcement**: All code must follow Red-Green-Refactor cycle
- **Test-First Approach**: No implementation code written before failing tests
- **Quality Gate**: 90%+ line coverage, 90%+ branch coverage, 95%+ function coverage
- **B2B Focus**: Enterprise patterns with accessibility-first development

### TDD Testing Patterns

#### Component Testing Structure (AAA Pattern)
```typescript
// Arrange-Act-Assert pattern for B2B components
describe('ComponentName', () => {
  it('should render with expected B2B enterprise styling', () => {
    // Arrange: Set up test data and dependencies
    const props = { variant: 'enterprise', size: 'large' };
    
    // Act: Render component
    render(<ComponentName {...props} />);
    
    // Assert: Verify expected behavior
    expect(screen.getByRole('button')).toHaveClass('enterprise-variant');
  });
});
```

#### B2B User Story Testing (Given-When-Then)
```typescript
// Given-When-Then structure for B2B workflows
describe('User Management Workflow', () => {
  it('should allow enterprise admin to bulk select users', async () => {
    // Given: Admin is on user management page with multiple users
    const users = generateMockUsers(50);
    render(<UserManagement users={users} />);
    
    // When: Admin clicks select all checkbox
    await user.click(screen.getByRole('checkbox', { name: /select all/i }));
    
    // Then: All user rows should be selected
    expect(screen.getAllByRole('checkbox', { checked: true })).toHaveLength(51); // 50 users + select all
  });
});
```

### TDD Cycle Enforcement

#### Red Phase Requirements
- Write failing test that describes desired B2B component behavior
- Test must fail for the right reason (feature not implemented)
- Test names must be descriptive of business value
- Must include accessibility requirements in test assertions

#### Green Phase Requirements
- Write minimal implementation to make test pass
- Focus on B2B enterprise patterns and requirements
- Implement accessibility features as part of core functionality
- No premature optimization or extra features

#### Refactor Phase Requirements
- Improve code quality while maintaining all tests
- Extract reusable B2B patterns and utilities
- Optimize for enterprise performance requirements
- Document accessibility compliance decisions

### B2B Component Testing Strategies

#### Form Component Validation Testing
```typescript
describe('Enterprise Form Validation', () => {
  it('should validate email with enterprise domain requirements', () => {
    // Test enterprise email validation patterns
    // Include accessibility announcements for errors
    // Validate against B2B domain restrictions
  });
  
  it('should support bulk data entry operations', () => {
    // Test CSV import functionality
    // Validate data transformation and error handling
    // Ensure progress indicators for large operations
  });
});
```

#### Data Table Interaction Testing
```typescript
describe('Enterprise Data Table', () => {
  it('should handle large datasets with virtualization', () => {
    // Test performance with 10,000+ rows
    // Validate virtualization behavior
    // Test keyboard navigation through large datasets
  });
  
  it('should support complex filtering and sorting', () => {
    // Test multi-column sorting
    // Validate advanced filter combinations
    // Test filter persistence across sessions
  });
});
```

#### Navigation Component Accessibility Testing
```typescript
describe('Enterprise Navigation Accessibility', () => {
  it('should support keyboard navigation with skip links', () => {
    // Test keyboard-only navigation
    // Validate skip to content functionality
    // Test screen reader announcements
  });
  
  it('should maintain focus management in complex layouts', () => {
    // Test focus trapping in modals
    // Validate focus restoration after dialogs
    // Test focus indicators visibility
  });
});
```

#### Chart Component Data Visualization Testing
```typescript
describe('Enterprise Chart Components', () => {
  it('should render accessible data visualizations', () => {
    // Test alternative text for chart data
    // Validate data table alternatives
    // Test high contrast mode compatibility
  });
  
  it('should handle real-time data updates', () => {
    // Test streaming data integration
    // Validate performance with live updates
    // Test accessibility announcements for changes
  });
});
```

#### Modal and Feedback Component Behavior Testing
```typescript
describe('Enterprise Modal System', () => {
  it('should implement proper focus management', () => {
    // Test focus trapping within modals
    // Validate return focus on close
    // Test escape key functionality
  });
  
  it('should support complex approval workflows', () => {
    // Test multi-step approval processes
    // Validate state management across steps
    // Test accessibility through workflow steps
  });
});
```

## Component Architecture Patterns

### shadcn/ui Integration Pattern
```typescript
// Base component structure for B2B components
export interface BaseComponentProps {
  variant?: 'default' | 'enterprise' | 'minimal';
  size?: 'sm' | 'md' | 'lg' | 'xl';
  accessibility?: {
    label?: string;
    describedBy?: string;
    required?: boolean;
  };
}

// TDD test pattern for all components
const TestComponent = React.forwardRef<HTMLElement, BaseComponentProps>(
  ({ variant = 'default', size = 'md', accessibility, ...props }, ref) => {
    // Implementation following TDD patterns
  }
);
```

### Enterprise Component Requirements
- **Keyboard Navigation**: Full keyboard accessibility
- **Screen Reader Support**: Proper ARIA labels and roles
- **High Contrast**: Support for high contrast modes
- **Responsive Design**: Mobile-first responsive behavior
- **Performance**: Optimized for large datasets
- **Internationalization**: RTL support and localization ready

## Testing Utilities and Setup

### Custom Test Utilities
```typescript
// B2B-specific testing utilities
export const renderWithProviders = (ui: React.ReactElement, options?: RenderOptions) => {
  const Wrapper = ({ children }: { children: React.ReactNode }) => (
    <ThemeProvider theme="enterprise">
      <ToastProvider>
        <QueryClient>
          {children}
        </QueryClient>
      </ToastProvider>
    </ThemeProvider>
  );
  
  return render(ui, { wrapper: Wrapper, ...options });
};

// Mock data generators for B2B scenarios
export const generateMockUsers = (count: number) => {
  // Generate realistic B2B user data
};

export const generateMockEnterpriseData = (type: 'users' | 'products' | 'orders', count: number) => {
  // Generate B2B-specific mock data
};
```

### Accessibility Testing Setup
```typescript
// Automated accessibility testing integration
import { axe, toHaveNoViolations } from 'jest-axe';

expect.extend(toHaveNoViolations);

describe('Component Accessibility', () => {
  it('should not have accessibility violations', async () => {
    const { container } = render(<Component />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```

### Performance Testing Integration
```typescript
// Performance testing for enterprise scenarios
import { ProfiledApp } from 'react-testing-library-profiler';

describe('Component Performance', () => {
  it('should render large datasets within performance budget', () => {
    const largeDataset = generateMockData(10000);
    
    render(
      <ProfiledApp>
        <DataTable data={largeDataset} />
      </ProfiledApp>
    );
    
    // Validate render time under 16ms threshold
    expect(getLastRenderTime()).toBeLessThan(16);
  });
});
```

## Quality Standards & Code Patterns

### Code Quality Requirements
- **TypeScript Strict Mode**: Full type safety
- **ESLint Rules**: Enterprise-grade linting configuration
- **Prettier**: Consistent code formatting
- **Husky + lint-staged**: Pre-commit quality gates
- **Conventional Commits**: Semantic commit messaging

### Component Naming Conventions
- **PascalCase**: All component names (Button, DataTable, FormField)
- **Descriptive Names**: Clear business intent (UserManagementTable, ApprovalWorkflow)
- **Composition Patterns**: Component.SubComponent (Card.Header, Card.Body)
- **Hook Naming**: use prefix for all custom hooks (useEnterpriseAuth, useDataTable)

### File Organization Pattern
```
src/
├── components/
│   ├── buttons/
│   │   ├── Button/
│   │   │   ├── Button.tsx           # Component implementation
│   │   │   ├── Button.test.tsx      # TDD test suite
│   │   │   ├── Button.stories.tsx   # Storybook stories
│   │   │   └── index.ts            # Exports
│   ├── forms/
│   ├── data-display/
│   ├── navigation/
│   ├── feedback/
│   └── charts/
├── lib/
│   ├── utils/
│   ├── hooks/
│   └── types/
├── styles/
│   ├── globals.css
│   └── tokens/
└── tests/
    ├── setup/
    ├── utils/
    └── fixtures/
```

## Storybook Integration

### Story Structure for TDD
```typescript
// Component stories following TDD patterns
export default {
  title: 'Components/Buttons/Button',
  component: Button,
  parameters: {
    docs: {
      description: {
        component: 'Enterprise button component with accessibility features and TDD validation.'
      }
    }
  }
};

// Stories that match TDD test scenarios
export const EnterpriseVariant = {
  args: {
    variant: 'enterprise',
    size: 'lg',
    children: 'Enterprise Action'
  }
};

export const AccessibilityDemo = {
  args: {
    'aria-label': 'Save user profile',
    'aria-describedby': 'save-help-text'
  },
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates accessibility features tested in TDD suite.'
      }
    }
  }
};
```

### Interactive Documentation
- **Controls**: All component props configurable
- **Actions**: Event handlers logged for testing
- **Accessibility**: Built-in a11y addon integration
- **Viewport**: Responsive design testing
- **Design Tokens**: Visual token documentation

## MCP Integration Points

### Context7 Usage
- Component API documentation and examples
- Design pattern references and best practices
- Accessibility guidelines and WCAG compliance
- Performance optimization techniques

### DeepWiki Integration
- React component lifecycle documentation
- TypeScript advanced patterns
- Testing methodologies and frameworks
- Enterprise architecture patterns

### Playwright E2E Testing
- Critical user journey testing
- Cross-browser compatibility validation
- Performance regression detection
- Accessibility compliance verification

### Brave Search Integration
- Latest React/TypeScript best practices
- Accessibility standards updates
- Performance benchmarking data
- Enterprise UI/UX patterns research

## Implementation Phases & TDD Checkpoints

### Phase 1: Foundation (Tasks 1-5)
**TDD Checkpoints**:
- [ ] Test utilities setup with 100% passing baseline
- [ ] Build system TDD validation (test → build → verify cycle)
- [ ] Storybook test integration working
- [ ] Accessibility testing framework operational

### Phase 2: Core Components (Tasks 6-10)
**TDD Checkpoints**:
- [ ] Button components: 90%+ test coverage achieved
- [ ] Typography: Screen reader compatibility verified
- [ ] Forms: Validation workflows fully tested
- [ ] Layout: Responsive behavior test suite complete

### Phase 3-6: Advanced Components (Tasks 11-26)
**TDD Checkpoints**:
- [ ] Data tables: Large dataset performance verified
- [ ] Navigation: Keyboard accessibility complete
- [ ] Feedback: User workflow testing validated
- [ ] Charts: Data visualization accessibility tested

### Phase 7-10: Quality & Deployment (Tasks 27-42)
**TDD Checkpoints**:
- [ ] Integration testing: All workflows verified
- [ ] Performance testing: Bundle size and render time validated
- [ ] E2E testing: Critical paths automated
- [ ] Documentation: TDD examples and patterns complete

## Success Metrics

### TDD Compliance
- **Test Coverage**: >90% line, >90% branch, >95% function
- **Test Quality**: All tests follow AAA or Given-When-Then patterns
- **Red-Green-Refactor**: Documented cycle compliance for all features
- **Test Performance**: All tests execute under 100ms average

### Accessibility Compliance
- **WCAG 2.1 AA**: 100% automated test compliance
- **Keyboard Navigation**: All components fully keyboard accessible
- **Screen Reader**: Complete compatibility with major screen readers
- **High Contrast**: Full support for high contrast modes

### Enterprise Requirements
- **Performance**: <50KB bundle size, <16ms render time
- **Scalability**: 10,000+ row data handling verified
- **Browser Support**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **Responsive**: Mobile-first design validated

This context provides Serena with comprehensive understanding of the TDD-focused B2B design system implementation requirements, testing patterns, quality standards, and enterprise-grade component architecture needed for the 42-task development process.